trigger:
  branches:
    include:
      - azure-pipeline
    exclude:
      - QA
      - Development
      - feature/*
pr: none 
pool:
  vmImage: 'ubuntu-latest'
parameters:
  - name: pomFile
    type: string
    default: 'pom.xml'
stages:
  - stage: Build
    jobs:
      - job:
        displayName: Build and Run Tests
        steps:
#          - task: SonarQubePrepare@5
#            inputs:
#              SonarQube: 'sonarqube'
#              scannerMode: 'CLI'
#              configMode: 'file'
#              configFile: 'sonar-scanner.properties'
#              extraProperties: 'sonar.projectKey=JavaProjectDemo'
#          - powershell: |
#              $params = "$env:SONARQUBE_SCANNER_PARAMS" -replace '"sonar.branch.name":"[\w/,-.]*"\,?'
#              Write-Host "##vso[task.setvariable variable=SONARQUBE_SCANNER_PARAMS]$params"
#            displayName: Set SonarScanner Params
#          - task: DockerCompose@0
#            displayName: Build SeleniumGrid
#            inputs:
#              containerregistrytype: Container Registry
#              dockerComposeFile: docker-compose.yml
#              dockerComposeCommand: 'up -d'
#          - task: Maven@3
#            displayName: Run Tests
#            inputs:
#              mavenPomFile: ${{parameters.pomFile}}
#              goals: 'test'
#              options: 'clean test -Dsurefire.suiteXmLFiles=regression.xml'
#              publishJUnitResults: true
#              testResultsFiles: '**/surefire-reports/*.xml'
#              javaHomeOption: 'JDKVersion'
#              mavenVersionOption: 'Default'
#              mavenAuthenticateFeed: false
#              effectivePomSkip: false
#              sonarQubeRunAnalysis: false
#              sqMavenPluginVersionChoice: 'latest'
#            continueOnError: true
#          - task: SonarQubeAnalyze@4
#          - task: SonarQubePublish@5
#            inputs:
#              pollingTimeoutSec: '300'
#          - powershell: |
#              Write-Host "Setting up the date time for build variable"
#              $date=$(Get-Date -format mmddyyyy-hhMMss)
#              Write-Host "##vso[task.setvariable variable=foo]$date"
          - task: CopyFiles@2
            displayName: Copy TestResult Files
            inputs:
              Contents: |
                *target/surefire-reports/*.html
              TargetFolder: '$(Build.ArtifactStagingDirectory)'
          - powershell: |
              Write-Host "Setting up the date time for build variable"
              $date=$(Get-Date -Format MM-dd-yyyy-hhmmss)
              Write-Host "##vso[task.setvariable variable=foo]$date"
              Rename-Item -Path "$(Build.ArtifactStagingDirectory)/target/surefire-reports/emailable-report.html" -emailable-report-"+'$(foo)'+" "emailable-report-"+'$(foo)'+".html"
            displayName: Set TimeStamp
          - task: PublishBuildArtifacts@1
            inputs:
              pathToPublish: '$(Build.ArtifactStagingDirectory)/target/surefire-reports/NewName.html'
              artifactName: Test Result $(foo)
#           - task: SendGrid@1
#             displayName: Email Test Results
#             inputs:
#               sendgridkey: '$(SendKeyToken)'
#               to: 'sangvhung@gmail.com'
#               from: 'exthung.sang@bcg.com'
#               subject: 'Test Result Report'
#               htmlbody: 'Build Complete'
#               addattachment: true
#               attachment: '$(Build.ArtifactStagingDirectory)/target/surefire-reports/emailable-report.html'
